---
- name: install deps
  apt: pkg={{ item }} state=latest update_cache=true
  with_items:
    - git
    - python3
    - redis-server
    - tree

- name: create ansible environment
  become: no
  command: ~/miniconda3/bin/conda create -n ansible python=2.7 --yes
  args:
    creates: ~/miniconda3/envs/ansible

- name: install ansible
  become: no
  pip:
    name=ansible
    executable=~/miniconda3/envs/ansible/bin/pip
    state=present

- name: clone batcave
  become: no
  git:
    repo=https://github.com/xsteadfastx/batcave.git
    dest=~/batcave

- name: run batcave
  become: no
  command:
    ~/miniconda3/envs/ansible/bin/ansible-playbook -i hosts base.yml -c local --extra-vars="hosts=localhost"
    chdir=~/batcave

- name: create conda environment
  become: no
  command:
    ~/miniconda3/bin/conda env create --force
    chdir=/vagrant
